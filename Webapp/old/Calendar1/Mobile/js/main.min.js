MyApp=function(f,g){return{init:function(){this.container=f;this.config=g?g:{};var a=new Date;this.currDate=new Date;this.currDate.setFullYear(a.getFullYear(),a.getMonth(),a.getDate());this.currDate.setHours(0,0,0,0);$("#title_bar").find(".back").bind(TUI.env.ua.ontouch?"tap":TUI.env.ua.clickEventUp,{handle:this},function(a){if(TUI.env.wx.ready)window.location.href=document.referrer;else try{api.closeFrame()}catch(e){window.location.href=document.referrer}return!1});$("#title_bar").find(".btn").bind(TUI.env.ua.ontouch?"tap":TUI.env.ua.clickEventUp,{handle:this},function(a){$("#tab_main").find(".subtitle_bar").empty();$("#tab_main").find(".subtitle_bar").html('\x3cspan class\x3d"back"\x3e\x3ci class\x3d"icon iconfont"\x3e\x26#xe620;\x3c/i\x3e\x26nbsp;\x26nbsp;\x26nbsp;\x3c/span\x3e\x3cspan class\x3d"ok"\x3e\u786e\u5b9a\x3c/span\x3e');$("#tab_main").find(".subtitle_body").html('\x3cdiv class\x3d"content"\x3e\x3cdiv class\x3d"article-list"\x3e\t\t\x3cdiv class\x3d"weui_cells_title"\x3e\u65e5\u7a0b\u65f6\u95f4\x3c/div\x3e\t\t\x3cdiv class\x3d"weui_cells weui_cells_form"\x3e\t\t\t\x3cdiv class\x3d"weui_cell"\x3e\t\t\t\t\x3cdiv class\x3d"weui_cell_bd weui_cell_primary"\x3e\t\t\t\t\t\x3cinput class\x3d"weui_input" id\x3d"startdate" type\x3d"text" value\x3d"'+a.data.handle.currDate.Format("yyyy-MM-dd")+'"\x3e\t\t\t\t\x3c/div\x3e\t\t\t\x3c/div\x3e\t\t\x3c/div\x3e\t\t\x3cdiv class\x3d"weui_cells_title"\x3e\u65e5\u7a0b\u5b89\u6392\x3c/div\x3e\t\t\x3cdiv class\x3d"weui_cells weui_cells_form"\x3e\t\t\t\x3cdiv class\x3d"weui_cell"\x3e\t\t\t\t\x3cdiv class\x3d"weui_cell_bd weui_cell_primary"\x3e\t\t\t\t\t\x3cinput id\x3d"title" class\x3d"weui_input" placeholder\x3d"\u8bf7\u8f93\u5165\u65e5\u7a0b\u5b89\u6392\u4e3b\u9898..."/\x3e\t\t\t\t\x3c/div\x3e\t\t\t\x3c/div\x3e\t\t\x3c/div\x3e\t\t\x3cdiv class\x3d"weui_cells_title"\x3e\u65e5\u5386\u5185\u5bb9\x3c/div\x3e\t\t\x3cdiv class\x3d"weui_cells weui_cells_form"\x3e\t\t\t\x3cdiv class\x3d"weui_cell"\x3e\t\t\t\t\x3cdiv class\x3d"weui_cell_bd weui_cell_primary"\x3e\t\t\t\t\t\x3ctextarea id\x3d"content" class\x3d"weui_textarea" placeholder\x3d"\u8bf7\u8f93\u5165\u65e5\u7a0b\u5b89\u6392\u5185\u5bb9" rows\x3d"6"\x3e\x3c/textarea\x3e\t\t\t\t\x3c/div\x3e\t\t\t\x3c/div\x3e\t\t\x3c/div\x3e\t\t\x3cdiv class\x3d"weui_cells_title"\x3e\x26nbsp;\x3c/div\x3e\t\x3c/div\x3e\x3c/div\x3e');$("#startdate").calendar();$("#tab_main").find(".back").bind(TUI.env.ua.clickEventUp,{handle:this},function(a){$("#tab_main").animate({left:"100%"},function(){$("#tab_main").find(".subtitle_body").empty();$("#tab_main").hide()});return!1});$("#tab_main").find(".ok").bind(TUI.env.ua.ontouch?"tap":TUI.env.ua.clickEventUp,{handle:this},function(a){a=$("#title").prop("value");if(""==a)$.toast("\u65e5\u7a0b\u5b89\u6392\u4e3b\u9898\u4e0d\u80fd\u4e3a\u7a7a","forbidden");else{var b=$("#content").prop("value");if(""==b)$.toast("\u65e5\u7a0b\u5b89\u6392\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a","forbidden");else{var c=$("#startdate").prop("value");$("#tab_main").animate({left:"100%"},function(){$("#tab_main").find(".subtitle_body").empty();$("#tab_main").hide()});$.ajax({type:"PUT",url:"/API/Calendar",data:{title:a,content:b,allDay:!0,start:c},dataType:"json",context:this,error:function(a){$.toast("\u7981\u6b62\u64cd\u4f5c","forbidden")},success:function(a){$.toast("\u4fdd\u5b58\u6210\u529f",function(){console.log("close")});TUI.env.mobile.currDate=TUI.Utils.parseDate(c);TUI.env.mobile.currDate.setHours(0,0,0,0);TUI.env.mobile.loadCalendar(TUI.env.mobile.currDate)}});return!1}}});$("#tab_main").show();$("#tab_main").animate({left:"0px"})});$("#tab_body").find(".weekbar").bind("swipe",function(a){"left"===a.direction?(TUI.env.mobile.currDate=TUI.env.mobile.currDate.DateAdd("d",7),TUI.env.mobile.loadCalendar(TUI.env.mobile.currDate)):"right"===a.direction&&(TUI.env.mobile.currDate=TUI.env.mobile.currDate.DateAdd("d",-7),TUI.env.mobile.loadCalendar(TUI.env.mobile.currDate))});this.loadCalendar(this.currDate);this.updateToken()},updateToken:function(){$.ajax({type:"get",url:"/API/WeiXin/AccessToken",dataType:"json",context:this,error:function(a){},success:function(a){TUI.env.wx=a;TUI.env.wx.ready=!1;""!=a.appid&&(wx.config({debug:!1,appId:a.appid,timestamp:a.timestamp,nonceStr:a.nonceStr,signature:a.signature,jsApiList:"onMenuShareTimeline onMenuShareAppMessage onMenuShareQQ onMenuShareWeibo stopRecord onVoiceRecordEnd translateVoice playVoice pauseVoice stopVoice onVoicePlayEnd uploadVoice downloadVoice chooseImage uploadImage getNetworkType openLocation getLocation closeWindow scanQRCode showOptionMenu showMenuItems hideAllNonBaseMenuItem showAllNonBaseMenuItem".split(" ")}),wx.ready(function(){TUI.env.wx.ready=!0}),setTimeout("TUI.env.mobile.updateToken();",1E3*(a.expires-a.lasttime)))}})},loadCalendar:function(a){navigator.onLine||$.toast("\u7f51\u7edc\u4e0d\u7ed9\u529b","forbidden");var d=a.getDay(),e="\u65e5\u4e00\u4e8c\u4e09\u56db\u4e94\u516d".split(""),b=a.DateAdd("d",-d),d=a.DateAdd("d",7-d);$("#title_bar").find(".dateTitle").html(a.Format("yyyy\u5e74MM\u6708"));for($("#tab_body").find(".weekbar").empty();b<d;){var c=0==b.getDay()||6==b.getDay()?' style\x3d"color:#ccc;"':"",c=a.getDate()==b.getDate()?$('\x3cdiv class\x3d"weekDay"\x3e\x3cp class\x3d"dayNum"'+c+"\x3e"+e[b.getDay()]+'\x3c/p\x3e\x3cdiv class\x3d"dateNum active"\x3e'+b.getDate()+"\x3c/div\x3e\x3cp"+c+"\x3e"+b.getLunar(3)+"\x3c/p\x3e\x3c/div\x3e"):$('\x3cdiv class\x3d"weekDay"\x3e\x3cp class\x3d"dayNum"'+c+"\x3e"+e[b.getDay()]+'\x3c/p\x3e\x3cdiv class\x3d"dateNum"'+c+"\x3e"+b.getDate()+"\x3c/div\x3e\x3cp"+c+"\x3e"+b.getLunar(3)+"\x3c/p\x3e\x3c/div\x3e");c.bind(TUI.env.ua.ontouch?"tap":TUI.env.ua.clickEventUp,{handle:this,config:b},function(a){a.data.handle.currDate=a.data.config;a.data.handle.loadCalendar(a.data.config)});$("#tab_body").find(".weekbar").append(c);b=b.DateAdd("d",1)}$.ajax({type:"GET",url:"srv/getCalendarList.tjs?startTime\x3d"+a.Format("yyyy-MM-dd")+"\x26endTime\x3d"+a.DateAdd("d",1).Format("yyyy-MM-dd"),dataType:"json",context:this,error:function(a){$.toast("\u7f51\u7edc\u4e0d\u7ed9\u529b","forbidden")},success:function(a){if(a.flag){$("#tab_body").find(".daylist").empty();if(a.weather){var b=$('\x3cdiv class\x3d"weui_panel weui_panel_access"\x3e\t\t\x3cdiv class\x3d"weui_panel_hd" style\x3d"padding: 0px;"\x3e\t\t\t\x3cdiv class\x3d"weui_media_box" style\x3d"color: #666;font-size:12pt;padding:0px;height: 100px;overflow: hidden;"\x3e\t\t\t\t\x3cdiv class\x3d"lt"\x3e\x3cspan style\x3d"font-size:28pt;"\x3e'+a.weather.day+'\x3c/span\x3e\x3cbr\x3e\x3cspan style\x3d"font-size:14pt;"\x3e'+a.weather.cop+'\x3c/span\x3e\x3c/div\x3e\t\t\t\t\x3cdiv class\x3d"rt1"\x3e\x3ci class\x3d"icon-weather-'+a.weather.code1+'"\x3e\x3c/i\x3e\x3c/div\x3e\t\t\t\t\x3cdiv class\x3d"rt2"\x3e'+a.weather.text+"\x3cp\x3e"+a.weather.low+"~"+a.weather.high+"\u2103\x3c/p\x3e\x3c/div\x3e\t\t\t\x3c/div\x3e\t\t\x3c/div\x3e\x3c/div\x3e");$("#tab_body").find(".daylist").append(b)}if(0==a.msg.length)$("#tab_body").find(".daylist").append('\x3cdiv style\x3d"padding:10px;text-align: center;"\x3e\u6ca1\u6709\u65e5\u7a0b\u4e8b\u4ef6\x3c/div\x3e');else for(var c=0;c<a.msg.length;c++)b="",b="\u65e5 \u5386"==a.msg[c].appname?'\x3cspan class\x3d"callendar_edit"\x3e\u7f16\u8f91\u65e5\u7a0b\x3c/span\x3e':'\x3cspan style\x3d"float: right;"\x3e'+a.msg[c].appname+"\x3c/span\x3e",b=$('\x3cdiv class\x3d"weui_panel weui_panel_access"\x3e\t\t\x3cdiv class\x3d"weui_panel_hd weui_cells_access"\x3e\x3cb style\x3d"color: black;font-size: 10.5pt;"\x3e'+a.msg[c].title+"\x3c/b\x3e"+b+'\x3c/div\x3e\t\t\x3cdiv class\x3d"weui_panel_hd" style\x3d"padding: 0px;"\x3e\t\t\t\x3cdiv class\x3d"weui_media_box" style\x3d"font-size:12pt;padding: 0px 5px 8px 15px;overflow: hidden;"\x3e\t\t\t\t\x3cdiv class\x3d"weui_media_bd"\x3e\t\t\t\t\t\x3cdiv style\x3d"margin: 10px 3px 5px 0px;overflow: hidden;text-overflow: ellipsis;display: -webkit-box;-webkit-box-orient: vertical;-webkit-line-clamp: 2;"\x3e'+unescape(unescape(a.msg[c].content))+"\x3c/div\x3e\t\t\t\t\x3c/div\x3e\t\t\t\x3c/div\x3e\t\t\x3c/div\x3e\x3c/div\x3e"),b.find(".callendar_edit").bind(TUI.env.ua.ontouch?"tap":TUI.env.ua.clickEventUp,{handle:this,msg:a.msg[c]},function(a){$("#tab_main").find(".subtitle_bar").empty();$("#tab_main").find(".subtitle_bar").html('\x3cspan class\x3d"back"\x3e\x3ci class\x3d"icon iconfont"\x3e\x26#xe620;\x3c/i\x3e\x26nbsp;\x26nbsp;\x26nbsp;\x3c/span\x3e\x3cspan class\x3d"ok"\x3e\u786e\u5b9a\x3c/span\x3e');$("#tab_main").find(".subtitle_body").html('\x3cdiv class\x3d"content"\x3e\x3cdiv class\x3d"article-list"\x3e\t\t\x3cdiv class\x3d"weui_cells_title"\x3e\u65e5\u7a0b\u65f6\u95f4\x3c/div\x3e\t\t\x3cdiv class\x3d"weui_cells weui_cells_form"\x3e\t\t\t\x3cdiv class\x3d"weui_cell"\x3e\t\t\t\t\x3cdiv class\x3d"weui_cell_bd weui_cell_primary"\x3e\t\t\t\t\t\x3cinput type\x3d"hidden" id\x3d"msgid" value\x3d"'+a.data.msg.id+'"\x3e\t\t\t\t\t\x3cinput class\x3d"weui_input" id\x3d"startdate" type\x3d"text" value\x3d"'+TUI.Utils.parseDate(a.data.msg.time).Format("yyyy-MM-dd")+'"\x3e\t\t\t\t\x3c/div\x3e\t\t\t\x3c/div\x3e\t\t\x3c/div\x3e\t\t\x3cdiv class\x3d"weui_cells_title"\x3e\u65e5\u7a0b\u5b89\u6392\x3c/div\x3e\t\t\x3cdiv class\x3d"weui_cells weui_cells_form"\x3e\t\t\t\x3cdiv class\x3d"weui_cell"\x3e\t\t\t\t\x3cdiv class\x3d"weui_cell_bd weui_cell_primary"\x3e\t\t\t\t\t\x3cinput id\x3d"title" class\x3d"weui_input" placeholder\x3d"\u8bf7\u8f93\u5165\u65e5\u7a0b\u5b89\u6392\u4e3b\u9898..." value\x3d"'+a.data.msg.title+'"/\x3e\t\t\t\t\x3c/div\x3e\t\t\t\x3c/div\x3e\t\t\x3c/div\x3e\t\t\x3cdiv class\x3d"weui_cells_title"\x3e\u65e5\u5386\u5185\u5bb9\x3c/div\x3e\t\t\x3cdiv class\x3d"weui_cells weui_cells_form"\x3e\t\t\t\x3cdiv class\x3d"weui_cell"\x3e\t\t\t\t\x3cdiv class\x3d"weui_cell_bd weui_cell_primary"\x3e\t\t\t\t\t\x3ctextarea id\x3d"content" class\x3d"weui_textarea" placeholder\x3d"\u8bf7\u8f93\u5165\u65e5\u7a0b\u5b89\u6392\u5185\u5bb9" rows\x3d"6"\x3e'+a.data.msg.content.replace(/<br>/g,"\n")+'\x3c/textarea\x3e\t\t\t\t\x3c/div\x3e\t\t\t\x3c/div\x3e\t\t\x3c/div\x3e\t\t\x3cdiv class\x3d"weui_cells_title"\x3e\x26nbsp;\x3c/div\x3e\t\x3c/div\x3e\x3c/div\x3e');$("#startdate").calendar();$("#tab_main").find(".back").bind(TUI.env.ua.clickEventUp,{handle:this},function(a){$("#tab_main").animate({left:"100%"},function(){$("#tab_main").find(".subtitle_body").empty();$("#tab_main").hide()});return!1});$("#tab_main").find(".ok").bind(TUI.env.ua.ontouch?"tap":TUI.env.ua.clickEventUp,{handle:this},function(a){a=$("#title").prop("value");if(""==a)$.toast("\u65e5\u7a0b\u5b89\u6392\u4e3b\u9898\u4e0d\u80fd\u4e3a\u7a7a","forbidden");else{var b=$("#content").prop("value");if(""==b)$.toast("\u65e5\u7a0b\u5b89\u6392\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a","forbidden");else{var c=$("#startdate").prop("value"),d=$("#msgid").prop("value");$("#tab_main").animate({left:"100%"},function(){$("#tab_main").find(".subtitle_body").empty();$("#tab_main").hide()});$.ajax({type:"POST",url:"/API/Calendar",data:{id:d,title:a,content:b,allDay:!0,start:c},dataType:"json",context:this,error:function(a){$.toast("\u7981\u6b62\u64cd\u4f5c","forbidden")},success:function(a){$.toast("\u4fdd\u5b58\u6210\u529f",function(){console.log("close")});TUI.env.mobile.currDate=TUI.Utils.parseDate(c);TUI.env.mobile.currDate.setHours(0,0,0,0);TUI.env.mobile.loadCalendar(TUI.env.mobile.currDate)}});return!1}}});$("#tab_main").show();$("#tab_main").animate({left:"0px"});return!1}),b.bind(TUI.env.ua.ontouch?"tap":TUI.env.ua.clickEventUp,{handle:this,config:a.msg[c]},function(a){if(navigator.onLine)return a.data.handle.openCalendar(a.data.config),!1;$.toast("\u7f51\u7edc\u4e0d\u7ed9\u529b","forbidden")}),$("#tab_body").find(".daylist").append(b)}else alert(a.info)}})},openCalendar:function(a){if(navigator.onLine){var d="",e={current:"",urls:[]};""!=a.imgfile&&void 0!=a.imgfile&&(d+='\x3cimg src\x3d"'+a.imgfile+'" width\x3d"100%" border\x3d"0" alt\x3d"" style\x3d"vertical-align: top;margin-bottom: 5px;"/\x3e',e.urls[e.urls.length]=window.location.protocol+"//"+window.location.hostname+":"+window.location.port+a.imgfile);$("#tab_main").find(".subtitle_bar").empty();$("#tab_main").find(".subtitle_bar").html('\x3cspan class\x3d"back"\x3e\x3ci class\x3d"icon iconfont"\x3e\x26#xe620;\x3c/i\x3e\x26nbsp;\x26nbsp;\x26nbsp;\x3c/span\x3e\x3cspan class\x3d"ok"\x3e\u5206\u4eab\x3c/span\x3e');$("#tab_main").find(".subtitle_body").html('\x3cdiv class\x3d"article-list write-pad" style\x3d"height:100%;background:rgb(255, 255, 252) url(./images/notes-lines.png) left top;line-height: 54px;"\x3e\t\t\x3cdiv class\x3d"title"\x3e'+unescape(unescape(a.title))+'\x3c/div\x3e\t\t\x3cdiv class\x3d"note"\x3e'+unescape(unescape(a.content))+d+'\x3cbr\x3e\x3cspan style\x3d"float:right;"\x3e'+TUI.Utils.parseDate(a.time).Format("yyyy\u5e74MM\u6708dd\u65e5")+"\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e");$("#tab_main").find(".subtitle_body .note img").bind(TUI.env.ua.ontouch?"tap":TUI.env.ua.clickEventUp,{handle:this,previewImage:e},function(a){a.data.previewImage.current=$(this)[0].currentSrc;wx.previewImage(a.data.previewImage);return!1});$("#tab_main").find(".back").bind(TUI.env.ua.clickEventUp,{handle:this},function(a){$("#tab_main").animate({left:"100%"},function(){$("#tab_main").find(".subtitle_body").empty();$("#tab_main").hide()});return!1});$("#tab_main").find(".ok").bind(TUI.env.ua.ontouch?"tap":TUI.env.ua.clickEventUp,{handle:this,config:a},function(b){$("#tab_main").animate({left:"100%"},function(){$("#tab_main").find(".subtitle_body").empty();$("#tab_main").hide()});$.ajax({type:"PUT",url:"/API/Contact/Community",data:{subject:a.title,content:a.content,imgurl:a.imgfile,apptag:"Calendar"},dataType:"json",context:this,error:function(a){$.toast("\u7981\u6b62\u64cd\u4f5c","forbidden")},success:function(a){$.toast("\u5206\u4eab\u793e\u533a\u6210\u529f",function(){console.log("close")})}});return!1});$("#tab_main").show();$("#tab_main").animate({left:"0px"})}else $.toast("\u7f51\u7edc\u4e0d\u7ed9\u529b","forbidden")},show:function(a){TUI.env.status="Mobile"},hide:function(a){}}};$(document).ready(function(){$.ajax({type:"get",url:"/System/srv/login.ejs",dataType:"json",error:function(f){window.location.href="/API/My/Login/?goto\x3d"+escape("/Webapp/Calendar/Mobile/")},success:function(f){TUI.env.us=f;TUI.env.mobile=new MyApp;TUI.env.mobile.init();TUI.env.mobile.show("normal")}})});